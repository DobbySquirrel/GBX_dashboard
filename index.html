<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vite App</title>
    <script>
      // 使用单例模式确保只加载一次
      window.BMapGLLoader = {
        promise: null,
        load() {
          if (this.promise) {
            return this.promise;
          }
          
          this.promise = new Promise((resolve, reject) => {
            if (window.BMapGL) {
              resolve(window.BMapGL);
              return;
            }
            
            const script = document.createElement('script');
            const ak = '%VITE_BAIDU_MAP_AK%';
            script.type = 'text/javascript';
            script.src = `https://api.map.baidu.com/api?v=3.0&type=webgl&ak=${ak}`;
            script.onload = () => {
              if (window.BMapGL) {
                resolve(window.BMapGL);
              } else {
                reject(new Error('BMapGL not found'));
              }
            };
            script.onerror = reject;
            document.head.appendChild(script);
          });
          
          return this.promise;
        }
      };
    </script>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
